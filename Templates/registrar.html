{% extends "base.html" %}

{% block title %}Registrar Produto - Tabacaria{% endblock %}

{% block content %}
<div class="header">
    <img src="{{ url_for('static', filename='Images/Logo_tabacaria.png') }}" alt="Logo" class="logo">
    <div>
        <h1 style="font-size:20px;">Registrar Novo Produto</h1>
        <p style="color:#999;margin-top:6px">Preencha os dados do produto</p>
    </div>
</div>

    <div class="panel">
      <h2 style="margin-bottom:16px;padding-bottom:8px">üìù Cadastro de Produto</h2>

            <form id="form-produto">
                <div class="form-group">
                    <input id="nome" placeholder="Nome do produto *" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <input id="categoria" placeholder="Categoria">
                    </div>
                    <div class="form-group">
                        <input id="preco" type="number" step="0.01" placeholder="Pre√ßo">
                    </div>
                </div>

                <div class="form-group">
                    <input id="quantidade" type="number" placeholder="Quantidade">
                </div>

        <div class="btn-group">
          <button type="submit" class="btn btn-primary">Salvar</button>
          <button type="button" class="btn btn-secondary" onclick="window.location.href='/'">Voltar</button>
        </div>
            </form>
{% endblock %}

            <p id="mensagem" style="margin-top:14px"></p>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script>
    const API = '/api/produtos';

    document.getElementById('form-produto').addEventListener('submit', async (e)=>{
      e.preventDefault();

      const nome = document.getElementById('nome').value.trim();
      const categoria = document.getElementById('categoria').value.trim();
      const preco = parseFloat(document.getElementById('preco').value) || 0;
      const quantidade = parseInt(document.getElementById('quantidade').value) || 0;
      const mensagem = document.getElementById('mensagem');

      if(!nome){
        mensagem.textContent = "‚ùå O nome do produto √© obrigat√≥rio.";
        mensagem.style.color = "red";
        return;
      }

      try {
        const res = await fetch(API, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({nome, categoria, preco, quantidade})
        });

        const data = await res.json();

        if(res.ok){
          mensagem.textContent = "‚úÖ " + (data.mensagem || 'Produto registrado com sucesso.');
          mensagem.style.color = "green";
          document.getElementById('form-produto').reset();
        } else {
          mensagem.textContent = "‚ùå " + (data.erro || "Erro ao registrar produto.");
          mensagem.style.color = "red";
        }

      } catch (err) {
        mensagem.textContent = "‚ö†Ô∏è Erro de conex√£o com o servidor.";
        mensagem.style.color = "red";
      }
    });
    </script>

</body>
</html>
