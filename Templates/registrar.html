<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Registrar Produto</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>Registrar Novo Produto</h1>

    <form id="form-produto">
      <input id="nome" placeholder="Nome do produto" required>
      <input id="categoria" placeholder="Categoria">
      <input id="preco" type="number" step="0.01" placeholder="Preço">
      <input id="quantidade" type="number" placeholder="Quantidade">
      <button type="submit">Salvar</button>
      <button type="button" onclick="window.location.href='/'">Voltar</button>
    </form>

    <p id="mensagem"></p>
  </div>

<script>
const API = '/api/produtos';

document.getElementById('form-produto').addEventListener('submit', async (e)=>{
  e.preventDefault();

  const nome = document.getElementById('nome').value.trim();
  const categoria = document.getElementById('categoria').value.trim();
  const preco = parseFloat(document.getElementById('preco').value) || 0;
  const quantidade = parseInt(document.getElementById('quantidade').value) || 0;
  const mensagem = document.getElementById('mensagem');

  if(!nome){
    mensagem.textContent = "❌ O nome do produto é obrigatório.";
    mensagem.style.color = "red";
    return;
  }

  try {
    const res = await fetch(API, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({nome, categoria, preco, quantidade})
    });

    const data = await res.json();

    if(res.ok){
      mensagem.textContent = "✅ " + data.mensagem;
      mensagem.style.color = "green";
      document.getElementById('form-produto').reset();
    } else {
      mensagem.textContent = "❌ " + (data.erro || "Erro ao registrar produto.");
      mensagem.style.color = "red";
    }

  } catch (err) {
    mensagem.textContent = "⚠️ Erro de conexão com o servidor.";
    mensagem.style.color = "red";
  }
});
</script>

</body>
</html>
